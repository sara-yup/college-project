<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Include the Bootstrap Table CSS for the table -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.19.1/bootstrap-table.min.css"
        integrity="sha512-Ulm5pOx2O8n6XDa0CY2S+GfOmV2R2SrvCpVmhjsxi4VmvcqB5JM5POLuePq496f9CkeAtvPpJlcjLRcTPk79iw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

        <!-- Include Google Fonts -->    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora&family=Oxygen:wght@300;700&display=swap" rel="stylesheet">

    <!-- My CSS -->  
    <style>

        h1 { 
            font-family: 'Lora', serif;
            font-size: 75px;
            padding-bottom: 5px;
        }

        h2 {
            font-family: 'Lora', serif;
            font-size: 35px;
            padding-bottom: 5px;
        }

        h4 {
            font-family: 'Oxygen', sans-serif;
            font-weight: 700;
            padding-bottom: 25px;
        }

        p {
            font-family: 'Oxygen', sans-serif;
            font-size: 20px;
            padding-bottom: 5px;
        }
        
        body {
            margin-top: 100px;
            margin-bottom: 100px;
            background-color: #f5eec5;
        }

        button a:hover {
            color: white;
        }

        button a {
            text-decoration: none;
            color: white;
        }

        button:hover {
            background-color: #60854e;
            border-color: #000000;
        }

        button {
            color: white;
            background-color: #7FB069;
            border-color: #000000;
            padding: 10px 22px;
            font-size: 16px;
            border-radius: 12px;
            margin-right: 100px;
        }

        thead {
            font-family: 'Oxygen', sans-serif;
            font-size: 25px;
            padding-bottom: 5px; 
        }

        .row {
            font-family: 'Oxygen', sans-serif;
            font-size: 20px;
            padding-bottom: 5px;
        }

        a {
            text-decoration: none;
            color: black;
            font-family: 'Oxygen', sans-serif;
            font-size: 20px;
            padding-bottom: 5px;
        }

        a:hover {
            color: #60854e;
        }

        table, tr {
            border: 1px solid black;
        }
         

    </style>

    <title>Student Results</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="span12">
                <h1>Check out your results.</h1>
                <h4 class="muted">Here's what we found based on your stats.</h4>
                <hr>
    
                <div class="row">
                    <table id="table">
                        <thead>
                            <tr>
                                <th data-field="collegeName" data-formatter="LinkFormatter">College Name</th>
                                <th data-field="locationCity">City</th>
                                <th data-field="locationState">State</th>
                                <th data-field="overallRec">Recommendation</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <!-- Footer section -->
            <div class="container">
                <hr>
                <div class="row">
                    </br>
                </div>
            </div>
        <p><button> <a href="student.html"> New Profile </a> </button></p>


    


    <!-- Include jQuery and other required files for Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.0/umd/popper.min.js"
        integrity="sha512-PZrlUFhlOigX38TOCMdaYkhiqa/fET/Lztzjn+kdGxefUZanNUfmHv+9M/wSiOHzlcLX/vcCnmvOZSHi5Dqrsw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>

    <!-- Include the JavaScript file for Bootstrap table -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.19.1/bootstrap-table.min.js"
        integrity="sha512-SoNdA/8QMSSlEcJAXKdAALavPMfGJnoh/96Tosg3qxQhdktSAttyHT7ePJghxJNvLCeyJYtXcdrTgLvHHsbRcQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Include the file where the JSON data is stored -->
    <script type="text/javascript" src="colleges.js"></script>

    <script type="text/javascript">
        var student = JSON.parse(localStorage.getItem("student"));

        function getStudentData() {
            /*
            document.getElementById("studentDetails").value =
                student.firstName + " " +
                student.lastName + " " +
                student.schoolName + " " +
                student.gpaScore + " " +
                student.actScore + " " +
                student.apCount;
            */
        }
    </script>
    <script type="text/javascript">

    </script>

    <script type="text/javascript">
        var gpaSafetyLevel = 0;
        var gpaTargetLevel = 0;
        var gpaReachLevel = 0;
        var gpaHardLevel = 0;

        var actSafetyLevel = 0;
        var actTargetLevel = 0;
        var actReachLevel = 0;
        var actHardLevel = 0;

        var apSafetyLevel = 0;
        var apTargetLevel = 0;
        var apReachLevel = 0;
        var apHardLevel = 0;

        var studentGPALevel = "";
        var studentACTLevel = "";
        var studentAPLevel = "";

        var gpaMultiplier = 0;
        var actMultiplier = 0;
        var apMultiplier = 0;

        const gpaWeight = 60;
        const actWeight = 25;
        const apWeight = 15;

        var gpaPoints = 0;
        var actPoints = 0;
        var apPoints = 0;
        
        var totalPoints = 0;
        var overallRec = "";

        $(document).ready(function () {
            getStudentData();
        });

        

        function LinkFormatter(value, row, index) {
            var params = new URLSearchParams();
            params.append("collegeID", row.collegeID);

            var customURL = "";
            customURL = "college.html?" + params.toString();

            //localStorage.setItem("college", JSON.stringify(arrdata[row.collegeID]));
            //return "<a href='"+row.collegeURL+"'>"+value+"</a>";
            return "<a href='"+customURL+"'>"+value+"</a>";
        }

        // Parse the imported data as JSON and store it
        var mydata = JSON.parse(colleges);
        let arrdata = [];
        let i = 0, j = 0;
        //console.log(mydata.length);
        for (let id of mydata) {

            studentGPALevel = "";
            studentACTLevel = "";
            studentAPLevel = "";

            // Setting various baseline levels for GPA
            if (id.baselineGPA == 'n/a') {
                // Minimum GPA is 2.00. So making sure that all levels floor is 2.00
                gpaSafetyLevel = 1.05 * 2;
                gpaTargetLevel = 2;
                gpaReachLevel = 2;
                gpaHardLevel = 2;
            } else {
                // Calculating on the (105% - 100% - 95% - 90%) distribution
                gpaSafetyLevel = 1.05 * id.baselineGPA;
                gpaTargetLevel = 1.00 * id.baselineGPA;
                gpaReachLevel = 0.95 * id.baselineGPA;
                gpaHardLevel = 0.90 * id.baselineGPA;
            }
            // Rounding to 2 decimals
            gpaSafetyLevel = gpaSafetyLevel.toFixed(2);
            gpaTargetLevel = gpaTargetLevel.toFixed(2);
            gpaReachLevel = gpaReachLevel.toFixed(2);
            gpaHardLevel = gpaHardLevel.toFixed(2);

            // Setting various baseline levels for ACT
            if (id.baselineACT == 'n/a') {
                // Many colleges don't require Test Scores
                // Assumption: 18 overall is a good baseline for those college who accept Test Scores
                actSafetyLevel = 1.10 * 18;
                actTargetLevel = 1.00 * 18;
                actReachLevel = 0.90 * 18;
                actHardLevel = 0.80 * 18;
            } else {
                // Calculating on the (110% - 100% - 90% - 80%) distribution
                actSafetyLevel = 1.10 * id.baselineACT;
                actTargetLevel = 1.00 * id.baselineACT;
                actReachLevel = 0.90 * id.baselineACT;
                actHardLevel = 0.80 * id.baselineACT;
            }
            // Rounding to 0 decimals
            actSafetyLevel = actSafetyLevel.toFixed(0);
            actTargetLevel = actTargetLevel.toFixed(0);
            actReachLevel = actReachLevel.toFixed(0);
            actHardLevel = actHardLevel.toFixed(0);

            // Setting various baseline levels for AP Courses
            if (id.baselineAPCount == 0) {
                apSafetyLevel = 1;
                apTargetLevel = 0;
                apReachLevel = 0;
                apHardLevel = 0;
            } else {
                // Calculating on the (120% - 100% - 80% - 60%) distribution
                apSafetyLevel = 1.20 * id.baselineAPCount;
                apTargetLevel = 1.00 * id.baselineAPCount;
                apReachLevel =  0.80 * id.baselineAPCount;
                apHardLevel = 0.60 * id.baselineAPCount;
            }
            // Rounding to 0 decimals
            apSafetyLevel = apSafetyLevel.toFixed(0);
            apTargetLevel = apTargetLevel.toFixed(0);
            apReachLevel = apReachLevel.toFixed(0);
            apHardLevel = apHardLevel.toFixed(0);

            //console.log(id.collegeName + " -> " + id.baselineGPA + " -> " + gpaHardLevel);
            //console.log(id.collegeName + " -> " + id.baselineACT + " -> " + actHardLevel);
            //console.log(id.collegeName + " -> " + id.baselineAPCount + " -> " + apHardLevel);

            // Determine GPA Level
            if (student.gpaScore >= gpaSafetyLevel) {
                studentGPALevel = "SAFETY";
                gpaMultiplier = 2;
            } else if (student.gpaScore >= gpaTargetLevel) {
                studentGPALevel = "TARGET";
                gpaMultiplier = 1;
            } else if (student.gpaScore >= gpaReachLevel) {
                studentGPALevel = "REACH";
                gpaMultiplier = 0.5;
            } else {
                studentGPALevel = "HARD";
                gpaMultiplier = -2;
            }

            //console.log("################# START HERE #################");

            // console.log("[GPA]" + gpaSafetyLevel + " / " + gpaTargetLevel + " / " + gpaReachLevel + " / " + gpaHardLevel);
            // console.log("[GPA]" + id.collegeName + " -> " + id.baselineGPA + " -> " + student.gpaScore + " -> " + studentGPALevel);

            // Determine ACT Level
            if (student.actScore >= actSafetyLevel) {
                studentACTLevel = "SAFETY"
                actMultiplier = 2
            } else if (student.actScore >= actTargetLevel) {
                studentACTLevel = "TARGET"
                actMultiplier = 1
            } else if (student.actScore >= actReachLevel) {
                studentACTLevel = "REACH"
                actMultiplier = 0.5
            } else {
                studentACTLevel = "HARD"
                actMultiplier = -2
            }

            // console.log("[ACT]" + actSafetyLevel + " / " + actTargetLevel + " / " + actReachLevel + " / " + actHardLevel);
            // console.log("[ACT]" + id.collegeName + " -> " + id.baselineACT + " -> " + student.actScore + " -> " + studentACTLevel);

            // Determine AP rigor Level
            if (student.apCount >= apSafetyLevel) {
                studentAPLevel = "SAFETY";
                apMultiplier = 2;
                console.log("Here 1");
            } else if (student.apCount >= apTargetLevel) {
                studentAPLevel = "TARGET";
                apMultiplier = 1;
                console.log("Here 2");
            } else if (student.apCount >= apReachLevel) {
                studentAPLevel = "REACH";
                apMultiplier = 0.5;
                console.log("Here 3");
            } else {
                studentAPLevel = "HARD";
                apMultiplier = -2;
                console.log("Here 4");
            }
            
            //console.log("[AP]" + apSafetyLevel + " / " + apTargetLevel + " / " + apReachLevel + " / " + apHardLevel);
            //console.log("[AP]" + id.collegeName + " -> " + id.baselineAPCount + " -> " + student.apCount + " -> " + studentAPLevel);

            gpaPoints = gpaWeight * gpaMultiplier;
            actPoints = actWeight * actMultiplier;
            apPoints = apWeight * apMultiplier;

            totalPoints = gpaPoints + actPoints + apPoints;

            if (totalPoints >= 120) {
                overallRec = "Safety";
            } else if (totalPoints >= 100) {
                overallRec = "Target";
            } else if (totalPoints >= 80) {
                overallRec = "Reach";
            } else {
                overallRec = "Hard Reach";
            }

            //console.log(id.collegeName + " >> " + studentGPALevel + " / " + studentACTLevel + " / " + studentAPLevel + " = " + overallRec);
            arrdata.push(
                    {
                    "collegeID" : id.collegeID,
                    "collegeName" : id.collegeName,
                    "collegeType" : id.collegeType,
                    "profileImage" : id.profileImage,
                    "collegeURL" : id.collegeURL,
                    "locationCity" : id.locationCity,
                    "locationState" : id.locationState,
                    "baselineACT" : id.baselineACT,
                    "baselineGPA" : id.baselineGPA,
                    "baselineAPCount" : id.baselineAPCount,
                    "acceptanceRate" : id.acceptanceRate,
                    "tuitionInState" : id.tuitionInState,
                    "tuitionOutOfState" : id.tuitionOutOfState,
                    "exclude" : id.exclude,
                    "firstName" : student.firstName,
                    "lastName" : student.lastName,
                    "schoolName" : student.schoolName,
                    "gpaScore" : student.gpaScore,
                    "actScore" : student.actScore,
                    "apCount" : student.apCount,
                    "totalPoints" : totalPoints,
                    "overallRec" : overallRec
                    }
            );
            localStorage.setItem("college-" + id.collegeID, JSON.stringify(arrdata[i]));
            i++;
        }
        i = 0;
        for (let id of arrdata) {
            //console.log(arrdata[i]);
            i++
        }

        var $table = $('#table');
        $table.bootstrapTable({data: arrdata});
        
    </script>
</body>

</html>